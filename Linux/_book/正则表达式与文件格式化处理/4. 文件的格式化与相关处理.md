# 文件的格式化与相关处理

#### 格式化打印: printf

- printf '打印格式' 实际内容
  - printf 不是管道命令

| 选项与参数 | 说明                                   |
| ---------- | -------------------------------------- |
| \a         | 警告声音输出                           |
| \b         | 退格键                                 |
| \f         | 清楚屏幕                               |
| \n         | 输出新的一行                           |
| \r         | 回车                                   |
| \t         | 水平的 [ Tab ] 按键                    |
| \v         | 垂直的 [ Tab ] 按键                    |
| \xNN       | NN为两位数的数字, 可以转换数字成为字符 |

- C语言程序内, 常见的变量格式

| 变量格式 | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| %ns      | n是数字, s 代表 string, 亦即多少个字符                       |
| %ni      | n是数字, i 代表 integer, 亦即多少整数位数                    |
| %N.nf    | n与N都是数字, f 代表 floating ( 浮点 ).<br />如果有小数位数, 如共要十个位数, 但小数点有两位, 即为%10.2f |

#### awk : 好用的数据处理工具

- sed 常常作用于一整个行的处理, awk 则比较倾向于一行当中分成数个字段来处理.
  - awk 相当适合处理小型的文本数据
- awk '条件类型1{操作1} 条件类型2{操作2} ...' filename
  - awk 后面接两个单引号并加上大括号来设置想要对数据进行的处理操作
  - awk 主要处理每一行的字段内的数据, 而默认的字段的分隔符为"空格键"或"[ Tab ]键"
  - 使用 awk 的时候, 请先确认一下数据, 如果是连续性的数据, 请不要有空格或 [ Tab ] 在内, 否则, 会产生误判.
  - 在 awk 的括号内, 每一行的每个字段都是有变量名称的, 那就是 $1, $2 等变量名称.
    - $1 就是第一栏, $2 就是第二栏, 以此类推.
    - $0 代表 [ 一整列数据 ] 的意思.
  - awk 的处理流程
    1. 读入第 1 行, 并将第 1 行的数据写入$0、$1、$2等变量当中.
    2. 根据 "条件类型" 的限制, 判断是否需要进行后面的 "操作".
    3. 完成所有操作与条件类型.
    4. 若还有后续的 [ 行 ] 的数据, 则重复上面 1\~3 的步骤, 直到所有的数据都读完为止.
  - awk 是以行为一次处理的单位, 而以字段为最小的处理单位.
- awk的内置变量
  - 注意: 在awk内的NR、NF等变量要用大写, 且不需要美元符号$.

| 内置变量 | 意义                          |
| -------- | ----------------------------- |
| NF       | 每一行 ( $0 ) 拥有的字段数    |
| NR       | 目前 awk 所处理的是第几行数据 |
| FS       | 目前的分隔字符, 默认是空格键  |

- awk 的逻辑运算字符

| 运算单元 | 意义       |
| -------- | ---------- |
| \>       | 大于       |
| <        | 小于       |
| \>=      | 大于或等于 |
| <=       | 小于或等于 |
| ==       | 等于       |
| !=       | 不等于     |

- 在awk中使用 print 功能可以格式化输出
  - 取出账号与登陆者的IP, 且账号与IP之间以 [ Tab ] 隔开.
    - last -n 5 |awk '{print $1 "\\t" $3}'
- 在awk中使用 BEGIN 关键词, 可以预先设置 awk 的变量
  - 读入第一行的时候, 第一行的数据还是以默认格式读入到变量中.
  - 在 /etc/passwd 当中是以 ":" 来作为分隔字符, 我要查看, 第三栏小于10以下的数据, 并且列出账号与第三列
    - cat /etc/passwd | awk 'BEGIN {FS=":"} $3<10 {print $1 "\\t" $3}'
- awk 的命令间隔: 所有 awk 的操作, 亦即在{}内的操作, 如果有需要多个命令辅助时, 可利用分号 ( ; ) 间隔, 或直接以 [ Enter ] 按键来隔开每个命令.

#### 文件比对工具

- 通常用在 ASCII 纯文本文件比对的命令中, 最常见的就是: diff
- 比对非纯文本文件, 可以使用: cmp
- diff
  - diff 就是用在比对两个文件之间的差异, 并且是以行为单位来比对, 一般是用在 ASCII 纯文本文件的比对上.
  - diff通常使用在同一个文件( 或软件 )的新旧版本差异上.
- diff [-bBi] from-file to-file

| 选项与参数 | 说明                                                         |
| ---------- | ------------------------------------------------------------ |
| from-file  | 一个文件名, 作为原始比对文件的文件名.<br />可以用 [ - ] 替换, [ - ] 代表 [ 标准输入 ] 之意. |
| to-file    | 一个文件名, 作为目标比对文件的文件名.<br />可以用 [ - ] 替换, [ - ] 代表 [ 标准输入 ] 之意. |
| -b         | 忽略一行当中, 仅有多个空白的差异.                            |
| -B         | 忽略空白行的差异.                                            |
| -i         | 忽略大小写的不同.                                            |

- cmp
  - cmp 主要比对两个文件, 它主要利用字节单位去比对, 因此, 可以比对二进制文件.
- cmp [-l] file1 file2

| 选项与参数 | 说明                                                         |
| ---------- | ------------------------------------------------------------ |
| -l         | 将所有不同点的字节处都列出来, 因为 cmp 默认仅会输出第一个发现的不同点. |

- patch : 处理补丁功能
  - patch 命令可以将旧版数据更新到新版 ( 主要亦由 diff 建立 patch 的补丁源文件)
  - patch 就是将旧的文件升级成新的文件
    1. 先比较旧版本的差异
    2. 将差异文件制作成为补丁文件
    3. 由补丁文件更新旧文件
  - 制作补丁文件
    - diff -Naur passwd.old passwd.new > passwd.patch
- 更新: patch -pN < patch_file

- 还原: patch -R -pN < patch_file

| 选项与参数 | 说明                                   |
| ---------- | -------------------------------------- |
| -p         | 后面可以接 [ 取消几层目录 ] 的意思     |
| -R         | 代表还原, 将新的文件还原成原来旧的版本 |

- 文件打印设置: pr